html_content = """
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Powered Task Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-image: url('https://img.freepik.com/free-vector/flat-scrum-task-board-with-hands-team-members-color-paper-stickers-group-software-developers-create-work-project-schedule-with-sticky-notes-teamwork-development-sprint-planning-concept_88138-909.jpg');
            background-size: cover;
            background-repeat: no-repeat;
            background-attachment: fixed; /* Optional: makes the background image fixed when scrolling */
            color: #000000; /* Black text */
        }
        #task-manager-page {
            background-image: url('https://share.google/images/x2Yh6Zrmx9kK1EAcH');
            background-size: cover;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }
        .task-card {
            transition: all 0.2s ease-in-out;
        }
        .task-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .modal-backdrop {
            background-color: rgba(0,0,0,0.5);
            transition: opacity 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s ease;
        }
        [v-cloak] {
            display: none;
        }
        .star {
            display: inline-block;
            width: 20px;
            height: 20px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>');
            background-size: cover;
            margin-right: 2px;
            color: transparent; /* Hide the default text */
        }
        .star.filled {
             background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>');
             color: gold; /* Color for filled stars */
        }

    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div id="app" v-cloak class="container mx-auto px-4 sm:px-6 lg:px-8 py-12 sm:py-16">

        <!-- Login Page -->
        <div id="login-page" v-if="!isLoggedIn" class="max-w-md mx-auto bg-white p-8 rounded-2xl shadow-md border border-slate-200/80">
            <h2 class="text-2xl font-bold text-center text-slate-900 mb-6">Login</h2>
            <div class="space-y-4">
                <div>
                    <label for="username" class="block text-sm font-medium text-slate-700">Username</label>
                    <input v-model="username" type="text" id="username" placeholder="Enter your username" class="mt-1 block w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
                </div>
                <div>
                    <label for="password" class="block text-sm font-medium text-slate-700">Password</label>
                    <input v-model="password" type="password" id="password" placeholder="Enter your password" class="mt-1 block w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
                </div>
                <button @click="simulateLogin" class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 transition shadow-sm">Login</button>
                <p v-if="loginError" class="text-red-500 text-center text-sm">{{ loginError }}</p>
            </div>
        </div>

        <!-- Task Manager Page -->
        <div id="task-manager-page" v-if="isLoggedIn">
            <!-- Header -->
            <header class="text-center mb-10">
                <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold text-slate-900 tracking-tight">
                    AI Task Prioritizer
                </h1>
                <p class="mt-3 text-xl text-slate-600 max-w-2xl mx-auto">
                    Add your tasks and stay organized while conquering them with ease.
                </p>
            </header>

            <!-- Rewards Section -->
            <div class="bg-white p-4 rounded-2xl shadow-md border border-slate-200/80 mb-6 max-w-2xl mx-auto text-center">
                <h3 class="text-lg font-semibold text-slate-900 mb-2">Your Rewards</h3>
                <p class="text-slate-700">Points: {{ userPoints }}</p>
                 <div class="mt-2">
                    <span v-for="star in maxStars" :key="star" class="star" :class="{ 'filled': star <= completedTasksRating }"></span>
                </div>
            </div>

            <!-- Add Task Form -->
            <div class="bg-white p-6 rounded-2xl shadow-md border border-slate-200/80 mb-10 max-w-2xl mx-auto">
                <h2 class="text-xl font-semibold text-slate-900 mb-4">Add a New Task</h2>
                <div class="space-y-4">
                    <input v-model="newTask.title" @keyup.enter="addTask" type="text" placeholder="Task Title (e.g., Launch new marketing campaign)" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition bg-blue-100">
                    <div class="relative">
                        <textarea v-model="newTask.description" placeholder="Task Description" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition h-24 resize-none"></textarea>
                        <button @click="generateDescription" :disabled="apiLoading || !newTask.title" class="absolute bottom-3 right-3 bg-amber-500 text-white px-3 py-1 rounded-md text-sm font-semibold hover:bg-amber-600 disabled:bg-slate-300 disabled:cursor-not-allowed transition flex items-center">
                            <span v-if="apiLoading && currentAction === 'description'">
                                <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                            </span>
                            ✨ Generate Description
                        </button>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <select v-model="newTask.category" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
                            <option value="">Select Category</option>
                            <option value="Work">Work</option>
                            <option value="Study">Study</option>
                            <option value="Personal">Personal</option>
                            <option value="Shopping">Shopping</option>
                            <option value="Health">Health</option>
                            <option value="Other">Other</option>
                        </select>
                        <input v-model="newTask.dueDate" type="date" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition bg-blue-100">
                    </div>
                    <button @click="addTask" class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 transition shadow-sm">Add Task</button>
                </div>
            </div>

            <!-- Task List -->
            <main>
                 <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-slate-800">Your Tasks</h2>
                    <button @click="prioritizeTasks" :disabled="apiLoading || tasks.length < 2" class="bg-emerald-500 text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-emerald-600 disabled:bg-slate-300 disabled:cursor-not-allowed transition flex items-center shadow-sm">
                         <span v-if="apiLoading && currentAction === 'prioritize'">
                            <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                        </span>
                        ✨ Prioritize All Tasks
                    </button>
                </div>
                <div v-if="tasks.length === 0" class="text-center py-10 bg-white rounded-2xl shadow-sm border border-slate-200/80">
                    <p class="text-slate-500">You have no tasks yet. Add one above to get started!</p>
                </div>
                <div v-else class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Task Card -->
                    <div v-for="(task, index) in sortedTasks" :key="task.id" class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200/80 task-card flex flex-col justify-between">
                        <div>
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="font-bold text-lg text-slate-800 pr-2" :class="{'line-through text-slate-400': task.completed}">{{ task.title }}</h3>
                                <span :class="getPriorityClass(task.priority)" class="text-xs font-semibold px-2.5 py-1 rounded-full whitespace-nowrap">{{ task.priority }}</span>
                            </div>
                            <p class="text-slate-600 text-sm mb-3">{{ task.description }}</p>
                            <p v-if="task.category" class="text-sm text-slate-500 mb-1"><span class="font-semibold">Category:</span> {{ task.category }}</p>
                            <p v-if="task.dueDate" class="text-sm text-slate-500 mb-4"><span class="font-semibold">Due:</span> {{ formatDate(task.dueDate) }}</p>
                             <!-- Reward Image Placeholder -->
                            <div v-if="task.completed" class="mt-4 text-center">
                                <img src="https://share.google/images/x2Yh6Zrmx9kK1EAcH" alt="Reward" class="mx-auto">
                            </div>
                        </div>
                        <div class="flex items-center justify-between mt-auto pt-4 border-t border-slate-200">
                            <button @click="suggestSubtasks(task)" :disabled="apiLoading" class="text-sky-600 hover:text-sky-800 text-sm font-semibold disabled:text-slate-400 disabled:cursor-not-allowed transition">✨ Suggest Subtasks</button>
                            <div class="flex items-center space-x-3">
                                <button @click="toggleTask(task)" class="text-gray-400 hover:text-green-600 transition" :class="{'text-green-600': task.completed}">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                                </button>
                                 <button @click="deleteTask(task.id)" class="text-gray-400 hover:text-red-600 transition">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Modal -->
        <div v-if="showModal" class="fixed inset-0 z-50 flex items-center justify-center p-4">
            <div @click="showModal = false" class="modal-backdrop fixed inset-0"></div>
            <div class="modal-content bg-white rounded-2xl shadow-xl w-full max-w-lg p-6 z-10 transform scale-100">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-slate-900">{{ modalTitle }}</h3>
                    <button @click="showModal = false" class="text-slate-400 hover:text-slate-600">&times;</button>
                </div>
                <div class="text-slate-700 whitespace-pre-wrap prose" v-html="modalContent"></div>
                <div v-if="apiLoading && currentAction !== 'description'" class="flex justify-center items-center mt-4">
                    <svg class="animate-spin h-8 w-8 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                    <p class="ml-3 text-slate-500">Gemini is thinking...</p>
                </div>
                <div class="mt-6 text-right">
                    <button @click="showModal = false" class="bg-slate-200 text-slate-800 font-bold py-2 px-5 rounded-lg hover:bg-slate-300 transition">Close</button>
                </div>
            </div>
        </div>

    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        const { createApp, ref, onMounted, computed, watch } = Vue;

        createApp({
            setup() {
                const tasks = ref([]);
                const newTask = ref({
                    title: '',
                    description: '',
                    priority: 'medium', // Keep default priority for internal logic or remove if not needed
                    dueDate: '',
                    category: '' // Add category to newTask
                });
                const apiLoading = ref(false);
                const showModal = ref(false);
                const modalTitle = ref('');
                const modalContent = ref('');
                const currentAction = ref('');
                const isLoggedIn = ref(false);
                const username = ref('');
                const password = ref('');
                const loginError = ref('');
                const userPoints = ref(0);
                const earnedBadges = ref([]);
                const maxStars = 5; // Define the maximum number of stars

                // Computed property to calculate the star rating based on completed tasks
                const completedTasksRating = computed(() => {
                    const completedCount = tasks.value.filter(task => task.completed).length;
                    // Simple linear scaling for now, can be adjusted
                    const rating = Math.min(maxStars, Math.floor(completedCount / 2)); // 1 star for every 2 completed tasks, max 5
                    console.log("Completed tasks count:", completedCount); // Log for debugging
                    console.log("Calculated star rating:", rating); // Log for debugging
                    return rating;
                });

                 // Computed property to sort tasks by priority
                const sortedTasks = computed(() => {
                    const priorityOrder = { 'high': 3, 'medium': 2, 'low': 1 }; // Define a numerical order for priorities
                    return [...tasks.value].sort((a, b) => {
                        const priorityA = priorityOrder[a.priority] || 0;
                        const priorityB = priorityOrder[b.priority] || 0;
                        // Sort by priority descending (High to Low)
                        if (priorityB !== priorityA) {
                            return priorityB - priorityA;
                        }
                        // Optional: secondary sort by due date ascending for same priority
                        if (a.dueDate && b.dueDate) {
                            return new Date(a.dueDate) - new Date(b.dueDate);
                        }
                        if (a.dueDate) return -1; // tasks with due dates first
                        if (b.dueDate) return 1;
                        return 0; // keep original order if no due dates
                    });
                });


                // Watch for changes in the tasks array to trigger updates
                watch(tasks, (newTasks, oldTasks) => {
                    console.log("Tasks array changed. Updating star rating.");
                     // No need to explicitly update completedTasksRating here,
                     // the computed property will automatically react to changes in tasks.
                     // This watch is primarily for debugging and confirming reactivity.
                }, { deep: true }); // Use deep: true to watch for changes within the objects in the array


                const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=`;
                const API_KEY = ""; // The API key is handled by the environment

                onMounted(() => {
                    if (isLoggedIn.value) {
                        const savedTasks = localStorage.getItem('tasks-ai');
                        if (savedTasks) {
                            const loadedTasks = JSON.parse(savedTasks);
                            // Add isEditing flag to loaded tasks
                            tasks.value = loadedTasks.map(task => ({
                                ...task,
                                isEditing: task.isEditing !== undefined ? task.isEditing : false // Ensure existing tasks have the flag
                            }));
                        }
                        const savedPoints = localStorage.getItem('userPoints-ai');
                        if (savedPoints !== null) {
                            userPoints.value = JSON.parse(savedPoints);
                        }
                        const savedBadges = localStorage.getItem('earnedBadges-ai');
                        if (savedBadges) {
                            earnedBadges.value = JSON.parse(savedBadges);
                        }
                    }
                });

                const saveTasks = () => {
                    localStorage.setItem('tasks-ai', JSON.stringify(tasks.value));
                };

                const saveRewards = () => {
                     localStorage.setItem('userPoints-ai', JSON.stringify(userPoints.value));
                     localStorage.setItem('earnedBadges-ai', JSON.stringify(earnedBadges.value));
                };

                const addTask = () => {
                    if (!newTask.value.title.trim()) return;
                    tasks.value.unshift({
                        id: Date.now(),
                        ...newTask.value,
                        completed: false,
                        priority: 'medium', // Set a default priority since the input is removed
                        isEditing: false // Add isEditing flag here
                    });
                    newTask.value = { title: '', description: '', priority: 'medium', dueDate: '', category: '' }; // Reset category as well
                    saveTasks();
                };

                const deleteTask = (id) => {
                    tasks.value = tasks.value.filter(task => task.id !== id);
                    saveTasks();
                };

                const toggleTask = (task) => {
                    task.completed = !task.completed;
                    if (task.completed) {
                        userPoints.value += 10;
                    } else {
                        userPoints.value = Math.max(0, userPoints.value - 10);
                    }
                    saveTasks();
                    saveRewards();
                };

                const getPriorityClass = (priority) => {
                    return {
                        'low': 'bg-green-100 text-green-800',
                        'medium': 'bg-yellow-100 text-yellow-800',
                        'high': 'bg-red-100 text-red-800'
                    }[priority];
                };

                const formatDate = (dateString) => {
                     if (!dateString) return 'No due date';
                     const date = new Date(dateString);
                     return date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric', timeZone: 'UTC' });
                };

                async function callGeminiAPI(prompt) {
                    apiLoading.value = true;
                    try {
                        const payload = {
                            contents: [{ parts: [{ text: prompt }] }],
                        };
                        const response = await fetch(GEMINI_API_URL + API_KEY, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        if (!response.ok) {
                            throw new Error(`API error: ${response.statusText}`);
                        }
                        const result = await response.json();
                        return result.candidates?.[0]?.content?.parts?.[0]?.text || "Sorry, I couldn't generate a response.";
                    } catch (error) {
                        console.error("Gemini API call failed:", error);
                        return `Error: Could not connect to the AI. ${error.message}`;
                    } finally {
                        apiLoading.value = false;
                        currentAction.value = '';
                    }
                }

                const generateDescription = async () => {
                    if (!newTask.value.title) return;
                    currentAction.value = 'description';
                    const prompt = `Generate a concise, one-paragraph task description for the following task title: "${newTask.value.title}". The description should be professional and actionable.`;
                    const description = await callGeminiAPI(prompt);
                    newTask.value.description = description.replace(/["*]/g, '');
                };

                const suggestSubtasks = async (task) => {
                    currentAction.value = 'subtasks';
                    modalTitle.value = `Suggested Subtasks for "${task.title}"`;
                    modalContent.value = '';
                    showModal.value = true;
                    const prompt = `Break down the following task into a clear, actionable list of 3-5 subtasks. Task: "${task.title}". Description: "${task.description}". Provide the subtasks as a numbered or bulleted list.`;
                    const subtasks = await callGeminiAPI(prompt);
                    modalContent.value = marked.parse(subtasks);
                };

                const prioritizeTasks = async () => {
                    if (tasks.value.length < 2) return;
                    currentAction.value = 'prioritize';
                    modalTitle.value = '✨ AI Task Prioritization Analysis';
                    modalContent.value = '';
                    showModal.value = true;

                    // Assign 'high' priority to 'Work', 'Study', and 'Health' tasks
                    const tasksToPrioritize = tasks.value.map(task => {
                        if (task.category === 'Work' || task.category === 'Study' || task.category === 'Health') {
                            return { ...task, priority: 'high' };
                        }
                        return task;
                    });

                    const taskData = tasksToPrioritize.map(t => ({title: t.title, priority: t.priority, dueDate: t.dueDate, completed: t.completed, category: t.category})); // Include category in taskData for prioritization

                    const prompt = `Analyze the following tasks and provide a prioritized order. **STRICTLY ADHERE** to these category-based priority levels, overriding other factors if necessary to ensure these are followed:
- Work: **ABSOLUTE HIGHEST** priority
- Health: **HIGH** priority
- Study: Medium priority
- Personal: Low priority
- Shopping: Lowest priority
- Other: Lowest priority

Additionally, consider due dates (sooner due dates are higher priority within the same category) and potential dependencies (e.g., planning before execution).

Here is the list of tasks in JSON format: ${JSON.stringify(taskData)}.

Format your response with a short "Prioritization Rationale" section explaining the logic, followed by a "Suggested Order" section listing the task titles in the recommended sequence. Ensure Health tasks are clearly prioritized as High.`;

                    const prioritization = await callGeminiAPI(prompt);
                    modalContent.value = marked.parse(prioritization);
                };

                const simulateLogin = () => {
                    if (username.value === 'admin' && password.value === 'password123') {
                        isLoggedIn.value = true;
                        loginError.value = '';
                        const savedTasks = localStorage.getItem('tasks-ai');
                        if (savedTasks) {
                            const loadedTasks = JSON.parse(savedTasks);
                            // Add isEditing flag to loaded tasks
                             tasks.value = loadedTasks.map(task => ({
                                ...task,
                                isEditing: task.isEditing !== undefined ? task.isEditing : false // Ensure existing tasks have the flag
                            }));
                        }
                        const savedPoints = localStorage.getItem('userPoints-ai');
                        if (savedPoints !== null) {
                            userPoints.value = JSON.parse(savedPoints);
                        }
                        const savedBadges = localStorage.getItem('earnedBadges-ai');
                        if (savedBadges) {
                            earnedBadges.value = JSON.parse(savedBadges);
                        }
                    } else {
                        loginError.value = 'Invalid username or password.';
                    }
                };


                return {
                    tasks,
                    newTask,
                    apiLoading,
                    showModal,
                    modalTitle,
                    modalContent,
                    currentAction,
                    isLoggedIn,
                    username,
                    password,
                    loginError,
                    userPoints,
                    earnedBadges,
                    maxStars,
                    completedTasksRating,
                    sortedTasks, // Make sortedTasks available to the template
                    addTask,
                    deleteTask,
                    toggleTask,
                    getPriorityClass,
                    formatDate,
                    generateDescription,
                    suggestSubtasks,
                    prioritizeTasks,
                    simulateLogin
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
"""
from IPython.display import HTML, display
# Write the HTML content to a file
with open('task_manager.html', 'w') as f:
    f.write(html_content)

# Display the HTML file
display(HTML('task_manager.html'))
